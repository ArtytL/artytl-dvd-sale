<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DVD Shop</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; padding: 24px; }
    #status { margin-top: 12px; font-size: 14px; opacity: 0.9; white-space: pre-wrap; }
    input, button { padding: 8px 12px; font-size: 14px; }
    button { cursor: pointer; }
  </style>
</head>
<body>
  <h1>‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h1>
  <form id="order-form">
    <input id="email" type="email" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì" required />
    <button type="submit">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</button>
  </form>
  <div id="status"></div>

  <script>
    // üëá ‡πÉ‡∏™‡πà‡πÇ‡∏î‡πÄ‡∏°‡∏ô Vercel ‡∏Ç‡∏≠‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå API ‡∏à‡∏£‡∏¥‡∏á
    // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏ü‡∏•‡πå API ‡∏Ç‡∏≠‡∏á‡∏ã‡∏±‡∏ô‡∏ä‡∏∑‡πà‡∏≠ "order-email.js" ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ /api/order-email
    // ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ "send-mail.js" ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏û‡∏≤‡∏ó‡πÄ‡∏õ‡πá‡∏ô /api/send-mail
    const API_BASE = "https://artytl-dvd-sale.vercel.app";
    const API_PATH = "/api/order-email"; // ‡∏´‡∏£‡∏∑‡∏≠ "/api/send-mail" ‡∏ñ‡πâ‡∏≤‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏±‡πâ‡∏ô‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏£‡∏¥‡∏á

    const $form = document.getElementById("order-form");
    const $status = document.getElementById("status");

    function setStatus(msg) { $status.textContent = msg; }

    $form.addEventListener("submit", async (e) => {
      e.preventDefault();
      setStatus("‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠...");

      const email = document.getElementById("email").value;
      try {
        const endpoint = `${API_BASE}${API_PATH}`;
        const res = await fetch(endpoint, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email }),
        });

        const ct = res.headers.get("content-type") || "";
        if (!ct.includes("application/json")) {
          const raw = await res.text();
          console.log("RAW RESPONSE:", raw);
          throw new Error("API ‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà JSON (‡πÄ‡∏ä‡πá‡∏Ñ API_BASE/‡∏û‡∏≤‡∏ó‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á)");
        }
        const json = await res.json();

        if (!res.ok) throw new Error(json?.error || `HTTP ${res.status}`);
        alert("‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‚úÖ");
        setStatus("‚úÖ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
      } catch (err) {
        console.error(err);
        setStatus("‚ùå " + (err?.message || "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î"));
        alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + (err?.message || "‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏"));
      }
    });
  </script>
</body>
</html>
